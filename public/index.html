<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Storm Surge Weather</title>
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3Eâ›ˆ%3C/text%3E%3C/svg%3E">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=IBM+Plex+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- SIDEBAR -->
<aside class="sidebar" id="sidebar">
  <div class="sidebar-logo">
    <span class="logo-bolt">â›ˆ</span>
    <span class="logo-name">StormSurge</span>
    <button class="sidebar-x" id="sidebarX" aria-label="Close sidebar">âœ•</button>
  </div>
  <div class="user-card">
    <div class="user-ava" id="userAva">SS</div>
    <div>
      <div class="user-nm" id="userNm">Weather User</div>
      <div class="user-sub" id="userSub">Not signed in</div>
    </div>
    <div class="dot-online"></div>
  </div>
  <nav class="sidenav">
    <a href="#" class="sni active" data-p="home"><span>âŒ‚</span> Dashboard</a>
    <a href="#" class="sni" data-p="alerts"><span>â—ˆ</span> Alerts <em id="navAlertBadge">0</em></a>
    <a href="#" class="sni" data-p="storm-central"><span>âš¡</span> Storm Central</a>
    <a href="#" class="sni" data-p="traffic"><span>ğŸ“·</span> Cameras</a>
    <a href="#" class="sni" data-p="settings"><span>â—</span> Settings</a>
  </nav>
  <div class="sidebar-bottom">
    <button class="theme-row" id="themeBtn">
      <span id="themeIcon">ğŸŒ™</span>
      <span id="themeLabel">Dark Mode</span>
      <div class="tog-mini" id="themeTog"></div>
    </button>
    <div class="ver-badge">v10.3 LIVE</div>
  </div>
</aside>

<!-- MAIN -->
<main class="main">
  <header class="topbar">
    <div class="tb-left">
      <button class="burger" id="burger" aria-label="Open menu"><span></span><span></span><span></span></button>
      <div class="loc-chip">
        <div class="loc-tag">LOCATION</div>
        <div class="loc-val" id="locName">New York</div>
      </div>
    </div>
    <div class="tb-mid">
      <div class="searchbox">
        <span class="s-ico" aria-hidden="true">âŒ•</span>
        <input id="searchInput" type="text" placeholder="Search city or zip..." autocomplete="off" spellcheck="false" aria-label="Search location">
        <div class="s-drop" id="searchDrop"></div>
      </div>
    </div>
    <div class="tb-right">
      <div class="live-pill"><span class="live-dot"></span>LIVE</div>
      <div class="date-pill" id="datePill">â€”</div>
      <button class="tb-btn" id="geoBtn" title="My location" aria-label="Use my location">â—</button>
      <button class="tb-btn" id="drawBtn" title="Draw on map" aria-label="Draw on map">âœ</button>
      <button class="tb-btn" id="refreshBtn" title="Refresh data" aria-label="Refresh">â†»</button>
    </div>
  </header>

  <div class="layerbar">
    <button class="lb active" data-layer="precipitation">ğŸŒ§ Radar</button>
    <button class="lb" data-layer="temperature">ğŸŒ¡ Temp</button>
    <button class="lb" data-layer="wind">ğŸ’¨ Wind</button>
    <button class="lb" data-layer="clouds">â˜ Clouds</button>
    <button class="lb" data-layer="pressure">ğŸ“Š Pressure</button>
    <div class="lb-divider" aria-hidden="true"></div>
    <button class="style-btn" id="styleBtn" aria-label="Cycle map style">â—‘ Map Style</button>
  </div>

  <!-- DRAW TOOLBAR (hidden by default) -->
  <div class="draw-toolbar" id="drawToolbar" role="toolbar" aria-label="Drawing tools">
    <span class="dt-label">âœ Draw Mode</span>
    <div class="dt-colors" role="group" aria-label="Colour">
      <button class="dc active" data-c="#f0a500" style="background:#f0a500" aria-label="Amber" title="Amber"></button>
      <button class="dc" data-c="#ff5c5c" style="background:#ff5c5c" aria-label="Red" title="Red"></button>
      <button class="dc" data-c="#00d4c8" style="background:#00d4c8" aria-label="Teal" title="Teal"></button>
      <button class="dc" data-c="#ffffff" style="background:#ffffff" aria-label="White" title="White"></button>
      <button class="dc" data-c="#22c55e" style="background:#22c55e" aria-label="Green" title="Green"></button>
    </div>
    <div class="dt-sizes" role="group" aria-label="Size">
      <button class="ds active" data-s="3">S</button>
      <button class="ds" data-s="6">M</button>
      <button class="ds" data-s="12">L</button>
    </div>
    <button class="dt-btn" id="drawUndo">â†© Undo</button>
    <button class="dt-btn" id="drawClear">ğŸ—‘ Clear</button>
    <button class="dt-btn danger" id="drawExit">âœ• Exit</button>
  </div>

  <div class="mapzone" id="mapzone">
    <div id="map"></div>
    <canvas id="radarCanvas" aria-hidden="true"></canvas>
    <canvas id="drawCanvas" aria-hidden="true"></canvas>

    <!-- WEATHER CARD -->
    <div class="wcard" id="wcard" role="complementary" aria-label="Current weather">
      <div class="wc-top">
        <div>
          <div class="wc-temp" id="wcTemp">--Â°C</div>
          <div class="wc-loc" id="wcLoc">New York</div>
          <div class="wc-desc" id="wcDesc">â€”</div>
        </div>
        <div class="wc-icon" id="wcIcon" aria-hidden="true">ğŸŒ¡</div>
      </div>
      <div class="wc-bar"></div>
      <div class="wc-grid" id="wcGrid">
        <div class="wc-stat" id="statFeels"><div class="wcs-l">Feels Like</div><div class="wcs-v" id="wcFeels">--</div></div>
        <div class="wc-stat" id="statHum">  <div class="wcs-l">Humidity</div>  <div class="wcs-v" id="wcHum">--</div></div>
        <div class="wc-stat" id="statWind"> <div class="wcs-l">Wind</div>      <div class="wcs-v" id="wcWind">--</div></div>
        <div class="wc-stat" id="statDir">  <div class="wcs-l">Direction</div> <div class="wcs-v" id="wcDir">--</div></div>
        <div class="wc-stat" id="statRain"> <div class="wcs-l">Rain</div>      <div class="wcs-v" id="wcRain">--</div></div>
        <div class="wc-stat" id="statPres"> <div class="wcs-l">Pressure</div>  <div class="wcs-v" id="wcPres">--</div></div>
        <div class="wc-stat" id="statCloud"><div class="wcs-l">Cloud Cover</div><div class="wcs-v" id="wcCloud">--</div></div>
        <div class="wc-stat" id="statUV">   <div class="wcs-l">UV Index</div>  <div class="wcs-v" id="wcUV">--</div></div>
      </div>
      <div class="wc-bar"></div>
      <div class="wc-sun" id="statSun">
        <span aria-hidden="true">ğŸŒ…</span><span id="wcSunrise">--:--</span>
        <span aria-hidden="true">ğŸŒ‡</span><span id="wcSunset">--:--</span>
      </div>
    </div>

    <!-- LEGEND -->
    <div class="legend" id="legend" aria-label="Radar legend">
      <div class="leg-title" id="legTitle">mm/h</div>
      <div class="leg-bar" id="legBar"></div>
      <div class="leg-nums" aria-hidden="true"><span>60</span><span>32</span><span>10</span><span>1</span><span>0</span></div>
    </div>

    <!-- MAP BUTTONS -->
    <div class="mapbtns">
      <button id="zoomIn" aria-label="Zoom in">ï¼‹</button>
      <button id="zoomOut" aria-label="Zoom out">ï¼</button>
    </div>

    <!-- CROSSHAIR -->
    <div class="crosshair" id="crosshair" aria-hidden="true">
      <div class="ch-h"></div><div class="ch-v"></div><div class="ch-ring"></div>
    </div>

    <!-- TIME BAR -->
    <div class="timebar" role="toolbar" aria-label="Radar timeline">
      <button class="t-arr" id="tPrev" aria-label="Previous frame">â€¹</button>
      <div class="tslots" id="tSlots" role="group" aria-label="Time slots"></div>
      <input type="range" id="tRange" min="0" max="0" value="0" aria-label="Radar timeline slider">
      <button class="t-arr" id="tNext" aria-label="Next frame">â€º</button>
      <button class="playbtn" id="playBtn" aria-label="Play/pause animation">â–¶</button>
      <button class="t-arr" id="latestBtn" aria-label="Jump to latest frame">â­</button>
      <label class="quick-op">FPS <input type="range" id="radarFps" min="2" max="16" value="8"></label>
      <button class="t-focus" id="tomorrowRadarBtn" title="Toggle Tomorrow.io radar layer">ğŸ›° Tomorrow Radar</button>
      <button class="t-focus" id="debugRadarBtn" title="Toggle radar debug overlay">ğŸ Radar Debug</button>
      <label class="quick-op">Rain <input type="range" id="rainOpacity" min="20" max="100" value="75"></label>
      <label class="quick-op">Tomorrow <input type="range" id="tomorrowOpacity" min="0" max="100" value="55"></label>
      <label class="quick-op">Opacity <input type="range" id="quickOpacity" min="20" max="100" value="75"></label>
    </div>
    <pre id="radarDebug" class="radar-debug" aria-live="polite"></pre>

    <div class="cam-dock" id="camDock" aria-label="Camera embed panel">
      <div class="cam-dock-head">
        <strong id="camDockTitle">Hazcams Live</strong>
        <button id="camDockClose" aria-label="Close camera panel">âœ•</button>
      </div>
      <iframe id="camDockFrame" title="Hazcams Camera" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
      <div class="cam-dock-note">If this camera is blocked from embedding, use <a id="camDockOpen" href="https://hazcams.com/" target="_blank" rel="noopener noreferrer">Open in new tab</a>.</div>
    </div>

  </div>
</main>

<!-- RIGHT PANEL -->
<aside class="rpanel" id="rpanel" aria-label="Alerts and radar info">
  <div class="rp-head">
    <button class="rpt active" data-rt="alerts">Alerts <span class="rpt-badge danger" id="alertBadge">0</span></button>
    <button class="rpt" data-rt="info">Radar</button>
  </div>
  <div class="rp-body" id="alertsBody">
    <div class="empty-s"><div class="es-ico">âœ“</div><div>Loading alerts...</div></div>
  </div>
</aside>

<!-- WEATHER REPORT / ALERT MODAL -->
<div class="modal" id="alertModal" role="dialog" aria-modal="true" aria-labelledby="mTitle">
  <div class="mbox large">
    <div class="mbox-head">
      <div class="mbox-title" id="mTitle">Alert</div>
      <button class="mbox-x" id="mClose" aria-label="Close">âœ•</button>
    </div>
    <div class="mbox-body" id="mBody"></div>
  </div>
</div>

<!-- STORM CENTRAL MODAL -->
<div class="modal" id="stormCentralModal" role="dialog" aria-modal="true" aria-label="Storm Central">
  <div class="mbox large">
    <div class="mbox-head">
      <div class="mbox-title">âš¡ Storm Central</div>
      <button class="mbox-x" id="scClose" aria-label="Close">âœ•</button>
    </div>
    <div class="mbox-body sc-body">
      <!-- Auth gate (shown when not logged in) -->
      <div id="scAuthGate">
        <div class="sc-auth-tabs" role="tablist">
          <button class="sc-at active" data-at="login" role="tab">Sign In</button>
          <button class="sc-at" data-at="register" role="tab">Create Account</button>
        </div>
        <div id="scLogin" class="sc-form">
          <input class="sc-input" id="loginEmail" type="email" placeholder="Email" autocomplete="email">
          <input class="sc-input" id="loginPass" type="password" placeholder="Password" autocomplete="current-password">
          <button class="sc-submit" id="loginBtn">Sign In</button>
          <div class="sc-err" id="loginErr" role="alert" aria-live="polite"></div>
        </div>
        <div id="scRegister" class="sc-form" style="display:none">
          <input class="sc-input" id="regName" type="text" placeholder="Display name" autocomplete="username">
          <input class="sc-input" id="regEmail" type="email" placeholder="Email" autocomplete="email">
          <input class="sc-input" id="regPass" type="password" placeholder="Password (min 6 chars)" autocomplete="new-password">
          <button class="sc-submit" id="registerBtn">Create Account</button>
          <div class="sc-err" id="regErr" role="alert" aria-live="polite"></div>
        </div>
        <div class="sc-note">Storm Central posts are shared publicly with all users.</div>
      </div>
      <!-- Feed (shown when logged in) -->
      <div id="scFeed" style="display:none">
        <div class="sc-user-bar">
          <span id="scUserLabel">Posting as <strong></strong></span>
          <button class="sc-signout" id="scSignout">Sign out</button>
        </div>
        <div class="sc-compose">
          <textarea class="sc-textarea" id="scText" placeholder="Share a weather observation... What did you see? Include your location!" aria-label="Post text"></textarea>
          <div class="sc-compose-meta">
            <span class="sc-loc-tag" id="scLocTag">ğŸ“ <span id="scPostLoc">New York</span></span>
            <div class="sc-compose-btns">
              <input type="file" id="scImgInput" accept="image/*" style="display:none" aria-hidden="true">
              <button class="sc-img-btn" id="scImgBtn" type="button">ğŸ“· Photo</button>
              <button class="sc-submit" id="scPostBtn">Post âš¡</button>
            </div>
          </div>
          <div id="scImgPreview" class="sc-img-preview"></div>
        </div>
        <div class="sc-posts" id="scPosts">
          <div class="empty-s"><div class="es-ico">âš¡</div><div>Loading posts...</div></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- CAMERAS MODAL -->
<div class="modal" id="trafficModal" role="dialog" aria-modal="true" aria-label="Cameras">
  <div class="mbox large">
    <div class="mbox-head">
      <div class="mbox-title">ğŸ“· Cameras</div>
      <button class="mbox-x" id="tcClose" aria-label="Close">âœ•</button>
    </div>
    <div class="mbox-body">
      <div class="tc-search">
        <input class="sc-input" id="tcSearch" type="text" placeholder="Search city, state, or route..." autocomplete="off" aria-label="Search cameras">
        <button class="sc-submit" id="tcSearchBtn">Search</button>
      </div>
      <div id="tcGrid" class="tc-grid">
        <div class="empty-s"><div class="es-ico">ğŸ“·</div><div>Search for a place to open live cameras on Hazcams</div></div>
      </div>
    </div>
  </div>
</div>

<!-- SETTINGS MODAL -->
<div class="modal" id="settingsModal" role="dialog" aria-modal="true" aria-label="Settings">
  <div class="mbox wide">
    <div class="mbox-head">
      <div class="mbox-title">âš™ Settings</div>
      <button class="mbox-x" id="sClose" aria-label="Close settings">âœ•</button>
    </div>
    <div class="mbox-body">

      <div class="s-sec">
        <div class="s-sec-title">Units</div>
        <div class="s-row"><span>Temperature</span>
          <div class="seg" id="sTempUnit" role="group" aria-label="Temperature unit">
            <button class="sb active" data-v="C">Â°C</button>
            <button class="sb" data-v="F">Â°F</button>
          </div>
        </div>
        <div class="s-row"><span>Wind Speed</span>
          <div class="seg" id="sWindUnit" role="group" aria-label="Wind speed unit">
            <button class="sb active" data-v="ms">m/s</button>
            <button class="sb" data-v="kmh">km/h</button>
            <button class="sb" data-v="mph">mph</button>
          </div>
        </div>
        <div class="s-row"><span>Time Format</span>
          <div class="seg" id="sTimeFormat" role="group" aria-label="Time format">
            <button class="sb active" data-v="12">12h</button>
            <button class="sb" data-v="24">24h</button>
          </div>
        </div>
      </div>

      <div class="s-sec">
        <div class="s-sec-title">Radar</div>
        <div class="s-row"><span>Opacity</span>
          <div class="slider-row">
            <input type="range" id="sOpacity" min="20" max="100" value="75" aria-label="Radar opacity">
            <span id="sOpacityVal">75%</span>
          </div>
        </div>
        <div class="s-row"><span>Animation Speed</span>
          <div class="seg" id="sSpeed" role="group" aria-label="Animation speed">
            <button class="sb" data-v="300">Fast</button>
            <button class="sb active" data-v="600">Normal</button>
            <button class="sb" data-v="1000">Slow</button>
          </div>
        </div>
        <div class="s-row"><span>Color Scheme</span>
          <div class="seg" id="sRadarColor" role="group" aria-label="Radar color scheme">
            <button class="sb" data-v="1">Original</button>
            <button class="sb" data-v="2">Universal</button>
            <button class="sb" data-v="4">Rainbow</button>
            <button class="sb active" data-v="6">NOAA</button>
          </div>
        </div>
        <div class="s-row"><span>Auto-play on Load</span>
          <label class="tog"><input type="checkbox" id="sAutoPlay"><span class="tog-t"></span></label>
        </div>
      </div>

      <div class="s-sec">
        <div class="s-sec-title">Map &amp; Interaction</div>
        <div class="s-row"><span>Show Alert Zones</span>
          <label class="tog"><input type="checkbox" id="sAlertZones" checked><span class="tog-t"></span></label>
        </div>
        <div class="s-row"><span>Show Crosshair</span>
          <label class="tog"><input type="checkbox" id="sCrosshair" checked><span class="tog-t"></span></label>
        </div>
        
        <div class="s-row"><span>Weather Card Position</span>
          <div class="seg" id="sCardPos" role="group" aria-label="Card position">
            <button class="sb active" data-v="top-left">â†– TL</button>
            <button class="sb" data-v="top-right">â†— TR</button>
            <button class="sb" data-v="bottom-left">â†™ BL</button>
          </div>
        </div>
      </div>

      <div class="s-sec">
        <div class="s-sec-title">Weather Card â€” Info Display</div>
        <div class="s-row"><span>Card Style</span>
          <div class="seg" id="sCardStyle" role="group" aria-label="Card style">
            <button class="sb active" data-v="full">Full</button>
            <button class="sb" data-v="compact">Compact</button>
            <button class="sb" data-v="minimal">Minimal</button>
          </div>
        </div>
        <div class="s-fields-grid">
          <label class="s-field-tog"><input type="checkbox" id="sfHumidity" checked> Humidity</label>
          <label class="s-field-tog"><input type="checkbox" id="sfWind" checked> Wind</label>
          <label class="s-field-tog"><input type="checkbox" id="sfRain" checked> Rain</label>
          <label class="s-field-tog"><input type="checkbox" id="sfPressure" checked> Pressure</label>
          <label class="s-field-tog"><input type="checkbox" id="sfCloud" checked> Cloud Cover</label>
          <label class="s-field-tog"><input type="checkbox" id="sfUV" checked> UV Index</label>
          <label class="s-field-tog"><input type="checkbox" id="sfSunTimes" checked> Sunrise/Sunset</label>
          <label class="s-field-tog"><input type="checkbox" id="sfFeels" checked> Feels Like</label>
        </div>
      </div>

      <div class="s-sec">
        <div class="s-sec-title">About</div>
        <div class="about-box">
          <div>Storm Surge Weather <strong>v10.3</strong></div>
          <div>Radar â€” RainViewer + Tomorrow.io (server proxy)</div>
                    <div>Forecast + Reports â€” WeatherNext2</div>
          <div>Alerts â€” weather.gov</div>
          <div>Maps â€” Mapbox GL JS</div>
          <div>Cameras â€” Hazcams</div>
          <div>Storage â€” Google Cloud Storage</div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast" role="status" aria-live="polite"></div>
<div class="loader" id="loader" role="status" aria-label="Loading"><div class="spin"></div><div class="load-txt">Loading...</div></div>

<script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
<script src="token.js"></script>
<script src="RadarAnimator.js"></script>
<script src="app.js"></script>
</body>
</html>
